<%- include('partials/header', { title: title }) %>
<%- include('partials/navbar') %>

<div class="container">
    <!-- Mensajes Flash -->
    <% if (success_msg) { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <%= success_msg %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    <% } %>
    
    <% if (error_msg) { %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <%= error_msg %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    <% } %>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="bi bi-gear"></i> Gestión de Ofertas (CRUD)</h1>
        <a href="/crud/nuevo" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Nueva Oferta
        </a>
    </div>

    <% if (ofertas.length > 0) { %>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Puesto</th>
                        <th>Empresa</th>
                        <th>Experiencia</th>
                        <th>Salario</th>
                        <th>Fecha Final</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <% ofertas.forEach(oferta => { %>
                        <tr>
                            <td><span class="badge bg-primary">#<%= oferta.NroId %></span></td>
                            <td><strong><%= oferta.Puesto %></strong></td>
                            <td>
                                <div><%= oferta.Empresa.RazonSoc %></div>
                                <small class="text-muted"><%= oferta.Empresa.Distrito %></small>
                            </td>
                            <td>
                                <span class="badge bg-info"><%= oferta.Experiencia %> años</span>
                            </td>
                            <td class="text-success fw-bold">S/<%= oferta.PagoMensual %></td>
                            <td><%= oferta.FechaFinal %></td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <a href="/crud/editar/<%= oferta.NroId %>" class="btn btn-outline-primary">
                                        <i class="bi bi-pencil"></i> Editar
                                    </a>
                                    <button type="button" class="btn btn-outline-danger" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#modalEliminar<%= oferta.NroId %>">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>

                                <!-- Modal de Eliminación -->
                                <div class="modal fade" id="modalEliminar<%= oferta.NroId %>" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Confirmar Eliminación</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <div class="modal-body">
                                                ¿Estás seguro de eliminar la oferta #<%= oferta.NroId %> - <%= oferta.Puesto %>?
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

                                                <form action="/crud/eliminar/<%= oferta.NroId %>" method="POST" style="display: inline;">
                                                    <input type="hidden" name="_method" value="DELETE">
                                                    <button type="submit" class="btn btn-danger">
                                                      <i class="bi bi-trash"></i>Eliminar
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
        
        <div class="alert alert-info mt-3">
            <i class="bi bi-info-circle"></i> Total: <strong><%= ofertas.length %></strong> ofertas registradas
        </div>
    <% } else { %>
        <div class="text-center py-5">
            <i class="bi bi-inbox display-1 text-muted"></i>
            <h3 class="mt-3">No hay ofertas registradas</h3>
            <p class="text-muted">Comienza creando tu primera oferta de trabajo</p>
            <a href="/crud/nuevo" class="btn btn-primary btn-lg mt-3">
                <i class="bi bi-plus-circle"></i> Crear Primera Oferta
            </a>
        </div>
    <% } %>
</div>

<%- include('partials/footer') %>